<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>
    <%= title %>
  </title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <link rel="stylesheet" href="/style/tchRegroup.css">
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <!--[if !IE]> -->
  <script type="text/javascript" src="/js/tool/jquery.js"></script>
  <!-- <![endif]-->
  <!--[if IE]>
        <script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
    <![endif]-->
  <!--[if lt IE 9]>
        <script src="https://cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
        <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
  <script type="text/javascript" src="/js/tool/layer/layer.js"></script>
</head>

<body>
  <%- include("share/header") %>
    <div class="main-wrapper">
      <div class="main-box">
        <%- include("share/menu")%>
        <div class="group">
                <div class="group-left">
                    <table border="1" style="border-collapse:collapse;" id="hTable" sortCol="-1">
                        <thead>
                        <tr>
                            <th>学生</th>
                            <th class="score">得分<b class="operate-arrow"></b></th>
                        </tr>
                        </thead>
                        <tbody>
                            <% for(var i=0;i<trData['left'].length;i++) {%>
                                <tr>
                                    <td><%= trData['left'][i]['user_name']%></td>
                                    <td><%= trData['left'][i]['score']%></td>
                                </tr>
                            <%}%>
                        </tbody>
                    </table>
                </div>
                <div class="group-right">
                    <div class="every-list">
                        <div class="group-title">
                            <span>选择第一小组名单：</span>
                            <div class="rt">
                                <select name="" id="" class="lf">
                                   <%for(var i=0;i<trData['right'].length;i++) {%>
                                    <option sysid="<%= trData['right'][i]['sysClassId']%>"><%= trData['right'][i]['userName']%></option>
                                    <%}%>
                                </select>
                                <button class="lf  add-meber" id="1">选择</button>
                            </div>
                        </div>
                        <div class="team-members">
                        </div>
                    </div>
                    <div class="every-list">
                        <div class="group-title">
                            <span>选择第二小组名单：</span>
                            <div class="rt">
                                <select name="" id="" class="lf">
                                    <% for(var i=0;i<trData['right'].length;i++) {%>
                                        <option sysid="<%= trData['right'][i]['sysClassId']%>"><%= trData['right'][i]['userName']%></option>
                                    <%}%>
                                </select>
                                <button class="lf add-meber" id="2">选择</button>
                            </div>
                        </div>
                        <div class="team-members">
                        </div>
                    </div>
                    <div class="every-list">
                        <div class="group-title">
                            <span>选择第三小组名单：</span>
                            <div class="rt">
                                <select name="" id="" class="lf">
                                    <% for(var i=0;i<trData['right'].length;i++) {%>
                                        <option sysid="<%= trData['right'][i]['sysClassId']%>"><%= trData['right'][i]['userName']%></option>
                                    <%}%>
                                </select>
                                <button class="lf add-meber" id="3">选择</button>
                            </div>
                        </div>
                        <div class="team-members">
                        </div>
                    </div>
                    <button type="button" class="submit-btn">确认</button>
                </div>
            </div>
      </div>
    </div>
    <script src="/js/sort.js"></script>
    <script>
        $(function(){
            $("#hTable").sortTable();
            $('.group-right .every-list').each(function(){
                $(this).children('.team-members').on('click','span',function(){
                    var sysGroupId = $.trim($(this).data('sysclassid')) 
                    var seleName=$.trim($(this).text());
                    var sysClassId=$.trim($(this).data('sysgroupid'));
                    var obj = {
                        sysClassId:seleName,
                        sysGroupId:sysGroupId,
                        userLoginname:sysClassId
                    }
                    console.log(obj)
                    for(var i=0;i<dataArr.length;i++) {
                        if(dataArr[i]['sysClassId'] == obj['sysClassId'] && dataArr[i]['sysGroupId'] == obj['sysGroupId'] && dataArr[i]['userLoginname'] == obj['userLoginname']) {
                            dataArr = dataArr.splice(i,1)
                        }
                    }
                    console.log(dataArr)
                    $(this).remove();
                })
            });
            var dataArr = []
            $('.group-right .every-list').each(function(){
                $(this).find('.add-meber').click(function(){
                    var sysGroupId = $.trim($(this).attr('id')) 
                    var seleName=$(this).prev('select').find('option:selected').text();
                    var sysId=$(this).prev('select').find('option:selected').attr('sysid');
                    var obj = {
                        sysClassId:sysId,
                        sysGroupId:sysGroupId,
                        userLoginname:seleName
                    }
                    var str = ''
                    if(dataArr.length > 0) {
                        for(var i=0;i<dataArr.length;i++) {
                            str += "<span data-sysclassid="+dataArr[i]['sysClassId']+" data-sysgroupid="+dataArr[i]['sysGroupId']+">"+dataArr[i]['userLoginname']+"<b></b></span>"
                            if(dataArr[i]['sysClassId'] != obj['sysClassId'] && dataArr[i]['sysGroupId'] != obj['sysGroupId'] && dataArr[i]['userLoginname'] != obj['userLoginname']) {
                                dataArr.push(obj)
                                str += "<span data-sysclassid="+obj['sysClassId']+" data-sysgroupid="+obj['sysGroupId']+">"+obj['userLoginname']+"<b></b></span>"
                            }else{
                                layer.alert('该组员已被分配',{
                                    title:'温馨提示'
                                })
                                return;
                            }
                        }
                    }else{
                        dataArr.push(obj)
                        str += "<span data-sysclassid="+obj['sysClassId']+" data-sysgroupid="+obj['sysGroupId']+">"+obj['userLoginname']+"<b></b></span>"
                    }
                    $(this).parents('.group-title').next('.team-members').append(str);
                })
            });
            //点击确认提交表单
            $('.submit-btn').click(function(){
                //提交表单
            })
        });
    </script>
</body>

</html>